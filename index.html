<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <!-- [PERBAIKAN] Mengaktifkan zoom untuk aksesibilitas -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Anime 3D Sub Ai - Nonton Donghua Sub Indo</title>
    <meta name="description" content="Nonton streaming Chinese Anime 3D (Donghua) terbaru dengan subtitle Indonesia.">
    <meta name="theme-color" content="#0f172a">

    <!-- PRECONNECT -->
    <link rel="preconnect" href="https://backup3d.ruslirusli123091.workers.dev">
    <link rel="icon" href="favicon.ico" sizes="any">

    <!-- IKLAN -->
    <script defer src="https://telegram.org/js/telegram-web-app.js"></script>
    <script defer type="text/javascript" src="https://pl28253644.effectivegatecpm.com/45/a0/58/45a058537afdc6637f4b27d76241566d.js" ></script>

    <!-- CSS MANUAL -->
    <style>
        :root {
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            /* [PERBAIKAN] Warna sedikit digelapkan untuk kontras lebih baik */
            --primary: #3176e8; 
            --primary-dark: #2563eb;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --green-share: #22c55e;
             /* [PERBAIKAN] Warna sedikit digelapkan untuk kontras lebih baik */
            --red-hot: #d92626;
            --pink-love: #ec4899;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-main); color: var(--text-main); font-size: 14px; line-height: 1.5; padding-bottom: 80px; }
        a { text-decoration: none; color: inherit; }
        button { border: none; background: none; color: inherit; cursor: pointer; font-family: inherit; }
        .hide { display: none !important; }
        
        /* LAYOUT */
        .container { max-width: 1100px; margin: 0 auto; padding: 16px; }
        
        /* HEADER */
        header { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 50; border-bottom: 1px solid #1e293b; height: 64px; display: flex; align-items: center; padding: 0 16px; gap: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .logo img { height: 40px; width: auto; }
        .search-box { flex: 1; max-width: 400px; position: relative; margin-left: auto; }
        .search-box input { width: 100%; background: #1e293b; border: 1px solid #334155; color: white; padding: 8px 16px; border-radius: 99px; outline: none; transition: 0.2s; }
        .search-box input:focus { border-color: var(--primary); }
        .search-results { position: absolute; top: 100%; left: 0; width: 100%; background: #1e293b; border: 1px solid #334155; border-radius: 8px; margin-top: 8px; max-height: 300px; overflow-y: auto; z-index: 60; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        .search-item { display: flex; gap: 10px; padding: 10px; border-bottom: 1px solid #334155; cursor: pointer; }
        .search-item:hover { background: #334155; }
        .search-item img { width: 35px; height: 50px; object-fit: cover; border-radius: 4px; }

        /* BANNER (HERO) */
        .hero-section { position: relative; margin-bottom: 24px; }
        .banner-container { position: relative; width: 100%; aspect-ratio: 16/9; max-height: 400px; border-radius: 16px; overflow: hidden; background: #1e293b; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3); }
        .banner-slide { position: absolute; inset: 0; opacity: 0; transition: opacity 0.5s ease; pointer-events: none; }
        .banner-slide.active { opacity: 1; pointer-events: auto; }
        .banner-bg { width: 100%; height: 100%; background-size: cover; background-position: center; }
        .banner-overlay { position: absolute; inset: 0; background: linear-gradient(to top, #0f172a 5%, transparent 90%); }
        .banner-content { position: absolute; bottom: 0; left: 0; padding: 20px; width: 100%; z-index: 2; }
        .badge-hot { background: var(--red-hot); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; margin-bottom: 8px; display: inline-block; }
        .banner-title { font-size: 1.25rem; font-weight: 900; margin-bottom: 10px; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .btn-watch-banner { background: var(--primary); color: white; padding: 8px 16px; border-radius: 99px; font-size: 12px; font-weight: bold; display: inline-flex; align-items: center; gap: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .banner-dots { position: absolute; bottom: 16px; right: 16px; display: flex; gap: 6px; z-index: 3; }
        .dot { width: 8px; height: 8px; background: #fff; opacity: 0.3; border-radius: 50%; cursor: pointer; transition: 0.3s; }
        .dot.active { opacity: 1; transform: scale(1.2); background: var(--primary); }

        /* MOVIE GRID */
        .section-title { font-size: 16px; font-weight: bold; margin-bottom: 16px; border-left: 4px solid var(--primary); padding-left: 10px; display: flex; align-items: center; }
        .movie-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        @media (min-width: 640px) { .movie-grid { grid-template-columns: repeat(4, 1fr); } .banner-title { font-size: 2rem; } }
        @media (min-width: 1024px) { .movie-grid { grid-template-columns: repeat(6, 1fr); gap: 16px; } }

        .movie-card { position: relative; border-radius: 8px; overflow: hidden; background: #1e293b; aspect-ratio: 2/3; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3); transition: transform 0.2s; cursor: pointer; }
        .movie-card:hover { transform: scale(1.03); z-index: 2; }
        .movie-card img { width: 100%; height: 100%; object-fit: cover; }
        .ep-badge { position: absolute; top: 6px; right: 6px; background: rgba(37, 99, 235, 0.9); color: white; font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .movie-info { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(15,23,42,1) 0%, transparent 100%); padding: 40px 8px 8px 8px; }
        .movie-title { font-size: 11px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* SYNOPSIS PAGE */
        .synopsis-container { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(51, 65, 85, 0.5); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; gap: 16px; backdrop-filter: blur(5px); }
        .synopsis-header { display: flex; gap: 16px; }
        .syn-poster { width: 110px; flex-shrink: 0; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); aspect-ratio: 2/3; }
        .syn-poster img { width: 100%; height: 100%; object-fit: cover; }
        .syn-info { flex: 1; display: flex; flex-direction: column; }
        .syn-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 8px; line-height: 1.3; }
        .syn-meta { font-size: 11px; color: var(--text-muted); margin-bottom: auto; }
        .syn-meta span { background: #334155; padding: 2px 6px; border-radius: 4px; color: white; margin-right: 5px; }
        
        .syn-actions { display: flex; gap: 8px; margin-top: 10px; }
        .btn-action { flex: 1; padding: 8px; border-radius: 6px; font-size: 12px; font-weight: bold; display: flex; justify-content: center; align-items: center; gap: 5px; transition: 0.2s; }
        .btn-fav { background: #334155; color: white; border: 1px solid #475569; }
        .btn-fav:hover { background: #475569; }
        .btn-share { background: rgba(22, 163, 74, 0.2); color: #4ade80; border: 1px solid #16a34a; }
        .btn-share:hover { background: #16a34a; color: white; }

        .syn-desc { font-size: 13px; color: #cbd5e1; line-height: 1.6; margin: 10px 0; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        .btn-main-watch { width: 100%; background: var(--primary); color: white; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 14px; box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3); margin-bottom: 16px; display: block; text-align: center; }
        .btn-main-watch:hover { background: var(--primary-dark); }

        /* GRID EPISODE */
        .ep-list-header { font-size: 12px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .ep-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; max-height: 250px; overflow-y: auto; padding-right: 4px; }
        .ep-grid-watch-page { grid-template-columns: repeat(7, 1fr); }
        @media (min-width: 1024px) { 
            .ep-grid { grid-template-columns: repeat(20, 1fr); } 
            .ep-grid-watch-page { grid-template-columns: repeat(4, 1fr); } 
        }

        .btn-ep { background: #1e293b; color: #94a3b8; border: 1px solid #334155; border-radius: 6px; aspect-ratio: 1/1; display: flex; justify-content: center; align-items: center; font-size: 11px; font-weight: bold; transition: 0.2s; }
        .btn-ep:hover { background: #334155; color: white; }
        .btn-ep.active { background: var(--primary); color: white; border-color: #60a5fa; box-shadow: 0 0 10px rgba(37, 99, 235, 0.5); }

        /* WATCH PAGE */
        .video-wrapper { width: 100%; aspect-ratio: 16/9; background: black; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-radius: 12px; overflow: hidden; }
        .video-wrapper iframe { width: 100%; height: 100%; border: none; }
        
        .server-bar { background: #0f172a; border: 1px solid #1e293b; padding: 10px; display: flex; gap: 8px; align-items: center; justify-content: space-between; margin-top: 12px; margin-bottom: 24px; border-radius: 8px; }
        .server-list { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 2px; }
        .btn-server { font-size: 11px; padding: 6px 12px; background: #1e293b; border: 1px solid #334155; border-radius: 4px; color: #ccc; white-space: nowrap; }
        .btn-server.active { background: var(--primary); color: white; border-color: var(--primary-dark); }
        .btn-rotate { background: #1e293b; color: white; border: 1px solid #334155; padding: 6px 10px; border-radius: 4px; font-size: 11px; display: flex; align-items: center; gap: 5px; font-weight: bold; }
        .rotate-active { position: fixed; top: 20px; left: 20px; background: #dc2626; border-color: #ef4444; transform: rotate(90deg); z-index: 100000; box-shadow: 0 0 15px rgba(0,0,0,0.8); }
        .forced-landscape { position: fixed !important; top: 50% !important; left: 50% !important; width: 100dvh !important; height: 100vw !important; z-index: 99999 !important; background: #000 !important; transform: translate(-50%, -50%) rotate(90deg) !important; margin: 0 !important; padding: 0 !important; }

        .watch-info { margin-bottom: 20px; padding: 0 4px; }
        .watch-title-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px; }
        .watch-title { font-size: 14px; font-weight: bold; color: white; line-height: 1.4; flex: 1; }
        .watch-actions { display: flex; gap: 10px; }
        .btn-icon { font-size: 18px; color: #94a3b8; padding: 4px; transition: 0.2s; }
        .btn-icon:hover { color: white; }
        .btn-icon.loved { color: var(--pink-love); }

        .ep-sidebar-box { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(51, 65, 85, 0.5); border-radius: 12px; padding: 16px; margin-bottom: 40px; }

        /* CHAT */
        .chat-box { background: #020617; border: 1px solid #1e293b; border-radius: 8px; padding: 12px; }
        .chat-header { font-size: 12px; font-weight: bold; margin-bottom: 10px; color: white; }
        .chat-messages { height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; padding-right: 5px; }
        .chat-bubble { font-size: 12px; }
        .chat-user { color: var(--primary); font-weight: bold; font-size: 11px; margin-bottom: 2px; }
        .chat-text { background: #1e293b; padding: 6px 10px; border-radius: 4px; color: #e2e8f0; display: inline-block; }
        .chat-input-area { display: flex; gap: 8px; }
        .chat-input { flex: 1; background: #1e293b; border: 1px solid #334155; color: white; padding: 6px 10px; border-radius: 4px; font-size: 12px; outline: none; }
        .btn-send { background: var(--primary); color: white; padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: bold; }

        /* SIDEBAR / POPULAR */
        .sidebar-item { display: flex; gap: 10px; padding: 8px; border-radius: 6px; align-items: center; cursor: pointer; transition: 0.2s; margin-bottom: 8px; }
        .sidebar-item:hover { background: #1e293b; }
        .sidebar-rank { font-size: 18px; font-weight: bold; color: #64748b; width: 25px; text-align: center; font-style: italic; }
        .sidebar-img { width: 45px; height: 60px; object-fit: cover; border-radius: 4px; background: #1e293b; }
        /* [PERBAIKAN] Mengganti h4 menjadi class untuk memperbaiki struktur heading */
        .sidebar-title { font-size: 12px; font-weight: bold; color: white; margin-bottom: 2px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .sidebar-info p { font-size: 10px; color: #94a3b8; }

        /* BOTTOM NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: #0f172a; border-top: 1px solid #1e293b; display: flex; justify-content: space-around; align-items: center; z-index: 50; padding-bottom: env(safe-area-inset-bottom); }
        /* [PERBAIKAN] Warna diganti untuk kontras lebih baik */
        .nav-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #8193b1; font-size: 10px; gap: 4px; width: 100%; height: 100%; }
        .nav-btn svg { width: 24px; height: 24px; }
        .nav-btn.active { color: var(--primary); font-weight: bold; }

        /* SCHEDULE PAGE */
        .schedule-tabs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px; }
        .sched-btn { background: #1e293b; color: #94a3b8; border: 1px solid #334155; padding: 8px; border-radius: 6px; font-size: 12px; font-weight: bold; transition: 0.2s; }
        .sched-btn:hover { background: #334155; }
        .sched-btn.active { background: var(--primary); color: white; border-color: var(--primary-dark); }

        /* PROFILE & AUTH */
        .profile-card { background: linear-gradient(to right, #1e293b, #0f172a); border: 1px solid #334155; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .btn-logout { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: bold; }
        .profile-tabs { display: flex; border-bottom: 1px solid #334155; margin-bottom: 16px; }
        .tab-btn { flex: 1; padding: 12px; text-align: center; font-size: 12px; font-weight: bold; text-transform: uppercase; color: #64748b; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .auth-box { background: #1e293b; padding: 24px; border-radius: 16px; border: 1px solid #334155; max-width: 350px; width: 100%; margin: 40px auto; }
        .auth-input { width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; margin-bottom: 12px; font-size: 14px; }
        .btn-auth-submit { width: 100%; background: var(--primary); padding: 12px; color: white; font-weight: bold; border-radius: 8px; font-size: 14px; }

        /* LOADING & SKELETON */
        #loading { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.8); z-index: 100; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .spinner { width: 40px; height: 40px; border: 4px solid #1e293b; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        .skeleton { background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* RESPONSIVE LAYOUT (DESKTOP) */
        @media (min-width: 1024px) {
            .container { padding: 24px; }
            .lg-flex { display: flex; gap: 24px; }
            .lg-main { width: 75%; }
            .lg-sidebar { width: 25%; }
            .ep-sidebar-box { margin-bottom: 24px; }
        }
    </style>
</head>
<body> 

    <!-- HEADER -->
    <header>
        <a href="/" onclick="event.preventDefault(); navigateTo('/');" class="logo" aria-label="Ke Beranda">
            <!-- [PERBAIKAN] Menambahkan alt text -->
            <img src="logo.png" alt="CA3D Logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <span style="display:none; font-weight:900; font-style:italic; font-size:18px; color:var(--primary);">CA3D</span>
        </a>
        <div class="search-box">
            <input type="search" id="site_search" placeholder="Cari Donghua..." autocomplete="off" oninput="doSearch(this.value)">
            <div id="search-results" class="search-results hide"></div>
        </div>
    </header>

    <main class="container">
        <!-- GLOBAL LOADING -->
        <div id="loading" class="hide"><div class="spinner"></div></div>
        
        <!-- HOME PAGE -->
        <div id="view-home" class="">
            <div id="hero-banner-container" class="hero-section skeleton" style="height: 220px;">
                <div id="banner-wrapper" class="banner-container"></div>
                <div id="banner-dots" class="banner-dots"></div>
            </div>
            
            <h2 class="section-title">Update Terbaru</h2>
            <div id="donghua-list" class="movie-grid">
                 <div class="skeleton" style="aspect-ratio:2/3;"></div>
                 <div class="skeleton" style="aspect-ratio:2/3;"></div>
                 <div class="skeleton" style="aspect-ratio:2/3;"></div>
            </div>
            <div id="pagination-container" style="margin-top: 30px; display: flex; justify-content: center; gap: 10px;"></div>
            
            <div style="margin-top: 40px; border-top: 1px solid #1e293b; padding-top: 20px;">
                <h2 class="section-title" style="border-color: var(--red-hot);">Sedang Populer üî•</h2>
                <div id="popular-list-home"></div>
            </div>
        </div>

        <!-- SYNOPSIS PAGE -->
        <div id="view-synopsis" class="hide">
            <div class="synopsis-container">
                <div class="synopsis-header">
                     <!-- [PERBAIKAN] Menambahkan alt text default -->
                    <div class="syn-poster"><img id="syn-image" src="" alt="Poster Donghua"></div>
                    <div class="syn-info">
                        <h1 id="syn-title" class="syn-title">Loading...</h1>
                        <div class="syn-meta">
                            <span id="syn-total-ep-info">0 Eps</span>
                            <span id="syn-views">0 Views</span>
                        </div>
                        <div id="synopsis-buttons" class="syn-actions"></div>
                    </div>
                </div>
                <div>
                    <h2 style="font-size:14px; margin-top:16px; margin-bottom:8px;">Sinopsis</h2>
                    <p id="syn-desc" class="syn-desc">Description...</p>
                </div>
                <button id="btn-start-watch" class="btn-main-watch">MULAI NONTON</button>
                
                <div style="border-top: 1px solid #334155; padding-top: 16px;">
                    <h2 class="ep-list-header">DAFTAR EPISODE</h2>
                    <div id="syn-episodes" class="ep-grid"></div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h2 class="section-title" style="border-color: var(--red-hot);">Rekomendasi üî•</h2>
                <div id="popular-list-syn"></div>
            </div>
        </div>

        <!-- WATCH PAGE -->
        <div id="view-watch" class="hide">
            <div class="lg-flex">
                <div class="lg-main">
                    <div class="video-wrapper" id="video-container">
                        <iframe id="video-player" title="Video Player" src="" allowfullscreen></iframe>
                    </div>
                    
                    <div class="server-bar">
                        <div class="server-list" id="server-list-container"></div>
                        <button id="btn-rotate-toggle" onclick="toggleLandscape()" class="btn-rotate">
                            <span>‚ü≥</span> Putar
                        </button>
                    </div>

                    <div style="border-bottom: 1px solid #1e293b; padding-bottom: 15px; margin-bottom: 15px;">
                        <div class="watch-info">
                            <div class="watch-title-row">
                                <h1 id="watch-title" class="watch-title">Title - Episode X</h1>
                                <div id="watch-page-buttons" class="watch-actions"></div>
                            </div>
                            <div style="font-size: 11px; color: #64748b;">
                                <span id="watch-views">0 Views</span> ‚Ä¢ <a id="back-link" href="#" style="color: var(--primary);">Detail Anime</a>
                            </div>
                        </div>
                    </div>

                    <div class="chat-box">
                        <div class="chat-header">Live Chat</div>
                        <div id="chat-container" class="chat-messages"></div>
                        <div id="chat-input-area" class="chat-input-area"></div>
                    </div>
                </div>
                
                <div class="lg-sidebar">
                    <div class="ep-sidebar-box">
                        <h2 class="ep-list-header">PILIH EPISODE</h2>
                        <div id="watch-ep-list" class="ep-grid ep-grid-watch-page" style="max-height: 400px;"></div>
                    </div>
                    <div>
                        <h2 class="section-title" style="border-color: var(--red-hot);">Lanjut Nonton üî•</h2>
                        <div id="popular-list-watch"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCHEDULE, AUTH, PROFILE -->
        <div id="view-schedule" class="hide">
            <h1 class="section-title">Jadwal Rilis</h1>
            <div id="sched-buttons-container" class="schedule-tabs"></div>
            <div id="schedule-content-grid" class="movie-grid"></div>
        </div>

        <div id="view-auth" class="hide" style="min-height: 60vh; display: flex; align-items: center;">
            <div class="auth-box">
                <div class="profile-tabs">
                    <div onclick="switchAuthMode('login')" id="tab-login" class="tab-btn active">Masuk</div>
                    <div onclick="switchAuthMode('register')" id="tab-register" class="tab-btn">Daftar</div>
                </div>
                <form id="form-login" onsubmit="event.preventDefault(); handleLogin();">
                    <input type="text" id="login-user" class="auth-input" placeholder="Username" autocomplete="username">
                    <input type="password" id="login-pass" class="auth-input" placeholder="Password" autocomplete="current-password">
                    <button type="submit" class="btn-auth-submit">Masuk</button>
                </form>
                <form id="form-register" class="hide" onsubmit="event.preventDefault(); handleRegister();">
                    <input type="text" id="reg-user" class="auth-input" placeholder="Username Baru" autocomplete="username">
                    <input type="password" id="reg-pass" class="auth-input" placeholder="Password" autocomplete="new-password">
                    <button type="submit" class="btn-auth-submit" style="background: var(--green-share);">Buat Akun</button>
                </form>
                <p id="auth-msg" style="text-align: center; font-size: 12px; margin-top: 10px; color: var(--yellow-400);"></p>
            </div>
        </div>

        <div id="view-profile" class="hide">
            <div class="profile-card">
                <div class="user-info">
                    <div class="avatar">üë§</div>
                    <div>
                        <div style="font-size: 10px; color: #94a3b8;">Halo,</div>
                        <div id="profile-name" style="font-weight: bold; font-size: 16px; color: white;">User</div>
                    </div>
                </div>
                <button onclick="userLogout()" class="btn-logout">Logout</button>
            </div>
            <div class="profile-tabs">
                <div onclick="switchProfileTab('bookmark')" id="tab-p-bookmark" class="tab-btn active">Favorit</div>
                <div onclick="switchProfileTab('history')" id="tab-p-history" class="tab-btn">Riwayat</div>
            </div>
            <div id="profile-content-list" class="movie-grid"></div>
        </div>
    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
        <button onclick="navigateTo('/')" id="nav-home" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span>Beranda</span>
        </button>
        <button onclick="navigateTo('?page=schedule')" id="nav-schedule" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            <span>Jadwal</span>
        </button>
        <button onclick="navigateToAccount()" id="nav-account" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            <span>Akun</span>
        </button>
    </nav>

    <script>
        const CONFIG = { workerUrl: "https://backup3d.ruslirusli123091.workers.dev" }; 
        let appData = { donghua: [] }, chatData = { comments: [] }, currentUser = null;
        let currentPage = 1; const ITEMS_PER_PAGE = 18;
        let currentProfileTab = 'bookmark'; let currentBannerIndex = 0; let bannerInterval;
        let activeScheduleDay = 'Senin';

        async function hashString(str) { const msgBuffer = new TextEncoder().encode(str.toLowerCase()); const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer); return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join(''); }
        async function hashPass(str) { const msgBuffer = new TextEncoder().encode(str); const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer); return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join(''); }
        function getLatestEp(eps) { if (!eps || eps.length === 0) return 0; return [...eps].sort((a, b) => parseFloat(b.ep) - parseFloat(a.ep))[0].ep; }
        
        (async function initApp() {
            const savedSession = localStorage.getItem('user_auth');
            if (savedSession) { try { currentUser = JSON.parse(savedSession); } catch(e){ currentUser=null; } }
            const daysMap = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            activeScheduleDay = daysMap[new Date().getDay()];
            renderSchedButtons();
            await fetchContent(); 
            checkRoute();
        })();

        window.addEventListener('hashchange', checkRoute);
        window.addEventListener('popstate', checkRoute);

        async function fetchContent() {
            if(appData.donghua.length === 0) {
                 document.getElementById('loading').classList.remove('hide');
                 document.getElementById('view-home').classList.remove('hide');
            }
            try { const r = await fetch(`${CONFIG.workerUrl}/api/donghua`); const j = await r.json(); appData.donghua = j.donghua || []; } catch(e){}
            document.getElementById('loading').classList.add('hide');
            document.getElementById('hero-banner-container').classList.remove('skeleton');
            document.getElementById('hero-banner-container').style.height = "auto";
            const list = document.getElementById('donghua-list');
            if(list.querySelector('.skeleton')) list.innerHTML = ''; 
        }

        async function fetchChatData() { try { const r = await fetch(`${CONFIG.workerUrl}/api/chat`); const j = await r.json(); chatData = j && j.comments ? j : { comments: [] }; } catch(e){} }

        function checkRoute() {
            const p = new URLSearchParams(window.location.search), page = p.get('page'), id = p.get('id'), ep = p.get('ep');
            document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hide'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            resetLandscapeMode();
            const videoFrame = document.getElementById('video-player');
            if (page !== 'watch' && videoFrame) videoFrame.src = "";
            if(bannerInterval) clearInterval(bannerInterval);

            if(appData.donghua.length === 0) { 
                document.getElementById('view-home').classList.remove('hide'); 
                if (document.getElementById('loading').classList.contains('hide') === false) return;
            }

            if(page === 'auth') { 
                if(currentUser){ navigateTo('?page=profile'); return; } 
                document.getElementById('view-auth').classList.remove('hide'); document.getElementById('nav-account').classList.add('active'); switchAuthMode('login'); 
            }
            else if(page === 'profile') { 
                if(!currentUser){ navigateTo('?page=auth'); return; } 
                document.getElementById('view-profile').classList.remove('hide'); document.getElementById('nav-account').classList.add('active'); renderProfile(); 
            }
            else if(page === 'schedule') { document.getElementById('view-schedule').classList.remove('hide'); document.getElementById('nav-schedule').classList.add('active'); switchScheduleTab(activeScheduleDay); }
            else if(page === 'synopsis' && id) { document.getElementById('view-synopsis').classList.remove('hide'); loadSynopsis(id); }
            else if(page === 'watch' && id && ep) { document.getElementById('view-watch').classList.remove('hide'); loadWatch(id, ep); }
            else { document.getElementById('view-home').classList.remove('hide'); document.getElementById('nav-home').classList.add('active'); renderHome(); }
            window.scrollTo(0, 0);
        }
        
        function navigateTo(u) { window.history.pushState({}, '', u); checkRoute(); }
        function navigateToAccount() { if (currentUser) navigateTo('?page=profile'); else navigateTo('?page=auth'); }

        async function handleLogin() {
            const u = document.getElementById('login-user').value.trim(); const p = document.getElementById('login-pass').value.trim();
            if(!u || !p) return document.getElementById('auth-msg').innerText = "Isi semua kolom";
            document.getElementById('auth-msg').innerText = "Sedang masuk...";
            const hashedUser = await hashString(u); const hashedPass = await hashPass(p);
            try {
                const req = await fetch(`${CONFIG.workerUrl}/api/member/login`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ username: hashedUser, password: hashedPass }) });
                const res = await req.json();
                if(req.ok && res.status === 'Success') {
                    currentUser = { username: hashedUser, password: hashedPass, display_name: u, bookmarks: res.user.bookmarks, history: res.user.history };
                    localStorage.setItem('user_auth', JSON.stringify(currentUser));
                    navigateTo('?page=profile');
                } else { document.getElementById('auth-msg').innerText = res.error || "Gagal Login"; }
            } catch(e) { document.getElementById('auth-msg').innerText = "Error Jaringan"; }
        }
        function userLogout() { currentUser = null; localStorage.removeItem('user_auth'); navigateTo('/'); }
        function switchAuthMode(m) { 
            const l=document.getElementById('tab-login'), r=document.getElementById('tab-register');
            const fL=document.getElementById('form-login'), fR=document.getElementById('form-register');
            document.getElementById('auth-msg').innerText="";
            if(m==='login'){ fL.classList.remove('hide'); fR.classList.add('hide'); l.classList.add('active'); r.classList.remove('active'); } 
            else { fR.classList.remove('hide'); fL.classList.add('hide'); r.classList.add('active'); l.classList.remove('active'); } 
        }
        async function toggleBookmark() {
            if(!currentUser) return alert("Login dulu untuk menyimpan Bookmark");
            const p = new URLSearchParams(window.location.search), id = p.get('id');
            if(!currentUser.bookmarks) currentUser.bookmarks = [];
            const idx = currentUser.bookmarks.indexOf(id);
            if(idx > -1) currentUser.bookmarks.splice(idx, 1); else currentUser.bookmarks.push(id);
            updateBookmarkUI(id);
            localStorage.setItem('user_auth', JSON.stringify(currentUser)); 
            fetch(`${CONFIG.workerUrl}/api/member/sync`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ username: currentUser.username, password: currentUser.password, bookmarks: currentUser.bookmarks, history: currentUser.history }) });
        }
        function updateBookmarkUI(id) {
            const isSaved = currentUser && currentUser.bookmarks.includes(id);
            const btnWatch = document.getElementById('btn-bookmark-watch');
            if(btnWatch) { btnWatch.innerHTML = isSaved ? '‚ù§Ô∏è' : 'ü§ç'; btnWatch.className = isSaved ? 'btn-icon loved' : 'btn-icon'; }
            const btnSyn = document.getElementById('btn-bookmark');
            if(btnSyn) { btnSyn.innerHTML = isSaved ? "‚ù§Ô∏è Favorit" : "ü§ç Favorit"; }
        }

        function renderHome() {
            if(appData.donghua.length === 0) return;
            renderBanner(); 
            const c = document.getElementById('donghua-list'); c.innerHTML = ""; 
            const sorted = [...appData.donghua].sort((a, b) => (b.lastUpdated || 0) - (a.lastUpdated || 0));
            const start = (currentPage-1)*ITEMS_PER_PAGE; 
            const pageData = sorted.slice(start, start + ITEMS_PER_PAGE);
            
            pageData.forEach(i => { 
                const latestEp = getLatestEp(i.episodes); 
                // [PERBAIKAN] Menambahkan alt text pada gambar
                c.innerHTML += `
                <div onclick="openSynopsisAndTrack('${i.id}')" class="movie-card">
                    <img src="${i.image}" alt="${i.title}" loading="lazy" class="poster-card" onload="this.classList.add('loaded')">
                    <div class="ep-badge">EP ${latestEp}</div>
                    <div class="movie-info">
                        <div class="movie-title">${i.title}</div>
                    </div>
                </div>`; 
            });
            
            const totalPages = Math.ceil(sorted.length / ITEMS_PER_PAGE);
            const pagContainer = document.getElementById('pagination-container');
            if(totalPages > 1) { 
                pagContainer.innerHTML = `
                <button onclick="changePage(${currentPage-1})" class="sched-btn" ${currentPage===1?'disabled':''}>&lt; Prev</button>
                <span style="color:#64748b; font-size:12px; display:flex; align-items:center;">${currentPage} / ${totalPages}</span>
                <button onclick="changePage(${currentPage+1})" class="sched-btn" ${currentPage===totalPages?'disabled':''}>Next &gt;</button>`;
            }
            renderSidebars();
        }
        function changePage(n) { currentPage = n; renderHome(); window.scrollTo({top:0, behavior:'smooth'}); }

        function renderBanner() {
            const sorted = [...appData.donghua].sort((a, b) => (b.lastUpdated || 0) - (a.lastUpdated || 0));
            const wrapper = document.getElementById('banner-wrapper'), dots = document.getElementById('banner-dots');
            if(sorted.length === 0) return;
            currentBannerIndex = 0; wrapper.innerHTML = ""; dots.innerHTML = "";
            
            sorted.slice(0, 5).forEach((item, index) => {
                const latestEp = getLatestEp(item.episodes);
                wrapper.innerHTML += `
                <div class="banner-slide ${index===0?'active':''}">
                    <div class="banner-bg" style="background-image: url('${item.image}');"></div>
                    <div class="banner-overlay"></div>
                    <div class="banner-content">
                        <div class="badge-hot">HOT UPDATE</div>
                        <h1 class="banner-title">${item.title}</h1>
                        <button onclick="navigateTo('?page=watch&id=${item.id}&ep=${latestEp}')" class="btn-watch-banner">
                            ‚ñ∂ TONTON EP ${latestEp}
                        </button>
                    </div>
                </div>`;
                const dot = document.createElement('div'); 
                dot.className = `dot ${index===0?'active':''}`; 
                dot.onclick = (e) => { e.stopPropagation(); changeBanner(index); resetBannerInterval(); }; 
                dots.appendChild(dot);
            });
            startBannerSlider(sorted.slice(0,5).length);
        }
        function changeBanner(i) { 
            const s=document.querySelectorAll('.banner-slide'), d=document.querySelectorAll('.dot'); 
            if(s.length===0)return; 
            s.forEach(el=>el.classList.remove('active')); d.forEach(el=>el.classList.remove('active')); 
            currentBannerIndex=i; if(currentBannerIndex>=s.length)currentBannerIndex=0; if(currentBannerIndex<0)currentBannerIndex=s.length-1; 
            s[currentBannerIndex].classList.add('active'); d[currentBannerIndex].classList.add('active'); 
        }
        function startBannerSlider(len) { if(bannerInterval) clearInterval(bannerInterval); if(len<=1)return; bannerInterval=setInterval(()=>changeBanner(currentBannerIndex+1),4000); }
        function resetBannerInterval() { const s=document.querySelectorAll('.banner-slide'); startBannerSlider(s.length); }

        function renderSidebars() {
             const s = [...appData.donghua].sort((a, b) => (b.views||0) - (a.views||0)).slice(0, 5);
             ['popular-list-home', 'popular-list-syn', 'popular-list-watch'].forEach(id => {
                 const el = document.getElementById(id); if(el) { 
                     el.innerHTML = ""; 
                     // [PERBAIKAN] Menambahkan alt text dan mengganti <h4> dengan <div>
                     s.forEach((i, x) => el.innerHTML += `
                     <div onclick="openSynopsisAndTrack('${i.id}')" class="sidebar-item">
                        <div class="sidebar-rank">${x+1}</div>
                        <img src="${i.image}" alt="${i.title}" class="sidebar-img">
                        <div class="sidebar-info">
                            <div class="sidebar-title">${i.title}</div>
                            <p>${i.views||0} Views</p>
                        </div>
                     </div>`); 
                 }
             });
        }

        async function openSynopsisAndTrack(id) { 
            const idx = appData.donghua.findIndex(d => d.id == id); 
            if(idx>-1){ 
                appData.donghua[idx].views=(appData.donghua[idx].views||0)+1; 
                fetch(`${CONFIG.workerUrl}/api/view`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}).catch(()=>{}); 
            } 
            navigateTo(`?page=synopsis&id=${id}`); 
        }
        
        function loadSynopsis(id) {
            const i = appData.donghua.find(d => d.id == id); 
            if (!i) { return navigateTo('/'); }

            document.getElementById('syn-title').innerText = i.title; 
            document.getElementById('syn-desc').innerText = i.synopsis; 
            const synImage = document.getElementById('syn-image');
            synImage.src = i.image;
            // [PERBAIKAN] Mengupdate alt text
            synImage.alt = i.title; 
            document.getElementById('syn-total-ep-info').innerText = (i.episodes?.length||0)+" Eps"; 
            document.getElementById('syn-views').innerText = (i.views||0)+" Views";
            
            const btnContainer = document.getElementById('synopsis-buttons');
            const isBookmarked = currentUser && (currentUser.bookmarks||[]).includes(id);
            
            btnContainer.innerHTML = `
                <button id="btn-bookmark" onclick="toggleBookmark()" class="btn-action btn-fav">
                    ${isBookmarked ? '‚ù§Ô∏è Favorit' : 'ü§ç Favorit'}
                </button>
                <button onclick="showShare('${id}',null,'${i.title}')" class="btn-action btn-share">
                    üîó Bagikan
                </button>
            `;
            
            const firstEp = (i.episodes && i.episodes.length > 0) ? [...i.episodes].sort((a,b)=>a.ep-b.ep)[0].ep : null;
            document.getElementById('btn-start-watch').onclick = () => { if(firstEp) navigateTo(`?page=watch&id=${id}&ep=${firstEp}`); else alert("Belum ada episode"); };
            
            const c = document.getElementById('syn-episodes'); c.innerHTML = "";
            (i.episodes||[]).sort((a,b)=>a.ep-b.ep).forEach(e => c.innerHTML += `<button onclick="navigateTo('?page=watch&id=${id}&ep=${e.ep}')" class="btn-ep">${e.ep}</button>`);
            renderSidebars();
        }

        function loadWatch(id, epNum) {
            const i = appData.donghua.find(d => d.id == id);
            if (!i) { return navigateTo('/'); }
            
            const e = i.episodes.find(x => x.ep == epNum);
            if (!e) { return navigateTo(`?page=synopsis&id=${id}`); }
            
            document.getElementById('watch-title').innerText = `${i.title} - Eps ${epNum}`; 
            document.getElementById('watch-views').innerText = `${i.views||0} Views`; 
            document.getElementById('back-link').onclick = (ev) => { ev.preventDefault(); navigateTo(`?page=synopsis&id=${id}`) };
            
            const btnContainer = document.getElementById('watch-page-buttons');
            btnContainer.innerHTML = `<button id="btn-bookmark-watch" onclick="toggleBookmark()" class="btn-icon">ü§ç</button><button onclick="showShare('${id}','${epNum}','${i.title}')" class="btn-icon">üîó</button>`;
            updateBookmarkUI(id);
            
            if(currentUser) { 
                if(!currentUser.history) currentUser.history=[]; 
                const hIdx=currentUser.history.findIndex(h=>h.id==id); if(hIdx>-1) currentUser.history.splice(hIdx,1); 
                currentUser.history.unshift({id, ep:epNum}); if(currentUser.history.length>50)currentUser.history.pop(); 
                localStorage.setItem('user_auth', JSON.stringify(currentUser)); 
                fetch(`${CONFIG.workerUrl}/api/member/sync`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ username: currentUser.username, password: currentUser.password, bookmarks: currentUser.bookmarks, history: currentUser.history }) });
            }
            
            const c = document.getElementById('watch-ep-list'); c.innerHTML = "";
            i.episodes.sort((a,b)=>a.ep-b.ep).forEach(ep => c.innerHTML += `<button onclick="navigateTo('?page=watch&id=${id}&ep=${ep.ep}')" class="btn-ep ${ep.ep==epNum?'active':''}">${ep.ep}</button>`);
            
            const streams = parseStreams(e.url); renderServerButtons(streams);
            if(streams.length>0) document.getElementById('video-player').src = streams[0].url;
            fetchChatData().then(() => renderChat(id, epNum)); renderSidebars();
            resetLandscapeMode();
        }

        function parseStreams(u) { if(!u.includes('|')) return [{name:"Default", url:u}]; return u.split('\n').map(l=>{const p=l.split('|'); return p.length>=2?{name:p[0].trim(),url:p.slice(1).join('|').trim()}:null}).filter(Boolean); }
        
        function renderServerButtons(s) { 
            const c = document.getElementById('server-list-container'); c.innerHTML = ""; 
            if(s.length <= 1) return;
            s.forEach((v,k)=>{ 
                const b = document.createElement('button'); b.className = `btn-server ${k===0?'active':''}`; b.innerText = v.name; 
                b.onclick = () => { document.getElementById('video-player').src = v.url; document.querySelectorAll('.btn-server').forEach(x => x.classList.remove('active')); b.classList.add('active'); }; 
                c.appendChild(b); 
            }); 
        }

        async function sendChat(dId, ep) { const inp=document.getElementById('chat-input'); if(!inp.value.trim())return; const newChat={id:Date.now().toString(), donghuaId:dId, ep, user:currentUser?currentUser.display_name:"User", text:inp.value.trim(), timestamp:Date.now()}; try { const r=await fetch(`${CONFIG.workerUrl}/api/chat`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",comment:newChat})}); if(r.ok){ inp.value=""; chatData.comments.push(newChat); renderChat(dId, ep); } } catch(e){} }
        function renderChat(dId, ep) { const c=document.getElementById('chat-container'), a=document.getElementById('chat-input-area'); if(currentUser) a.innerHTML=`<input type="text" id="chat-input" class="chat-input" placeholder="Ketik..."><button onclick="sendChat('${dId}','${ep}')" class="btn-send">Kirim</button>`; else a.innerHTML=`<button onclick="navigateTo('?page=auth')" class="btn-server" style="width:100%">Login untuk Chat</button>`; const msgs=chatData.comments.filter(x=>x.donghuaId===dId && x.ep==ep).sort((a,b)=>a.timestamp-b.timestamp); c.innerHTML=msgs.length?"":`<div style="text-align:center;color:#64748b;font-size:10px;margin-top:20px;">Belum ada komentar</div>`; msgs.forEach(m=>{ c.innerHTML+=`<div class="chat-bubble"><div class="chat-user">${m.user}</div><div class="chat-text">${m.text}</div></div>`; }); c.scrollTop=c.scrollHeight; }

        function renderSchedButtons() { const d=["Senin","Selasa","Rabu","Kamis","Jumat","Sabtu","Minggu"]; const c=document.getElementById('sched-buttons-container'); c.innerHTML=""; d.forEach(day => { c.innerHTML += `<button onclick="switchScheduleTab('${day}')" id="btn-${day}" class="sched-btn">${day}</button>`; }); }
        function switchScheduleTab(day) { activeScheduleDay=day; document.querySelectorAll('.sched-btn').forEach(b=>b.classList.remove('active')); document.getElementById(`btn-${day}`).classList.add('active'); const c=document.getElementById('schedule-content-grid'); c.innerHTML=""; const list=appData.donghua.filter(d=>d.day && d.day.includes(day)); list.forEach(i=>{ c.innerHTML+=`<div onclick="openSynopsisAndTrack('${i.id}')" class="movie-card"><img src="${i.image}" alt="${i.title}" class="poster-card loaded"><div class="movie-info"><div class="movie-title">${i.title}</div></div></div>`; }); if(list.length===0) c.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:20px;color:#64748b;">Libur</div>`; }

        function renderProfile() { 
            document.getElementById('profile-name').innerText = currentUser?currentUser.display_name:"User"; 
            document.getElementById('tab-p-bookmark').className=`tab-btn ${currentProfileTab==='bookmark'?'active':''}`; 
            document.getElementById('tab-p-history').className=`tab-btn ${currentProfileTab==='history'?'active':''}`; 
            const c=document.getElementById('profile-content-list'); c.innerHTML=""; 
            let data = currentProfileTab==='bookmark' ? (currentUser.bookmarks||[]).map(id=>appData.donghua.find(d=>d.id==id)).filter(Boolean) : (currentUser.history||[]).map(h=>{const d=appData.donghua.find(x=>x.id==h.id); return d?{...d,lastEp:h.ep}:null}).filter(Boolean);
            if(data.length===0) c.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:20px;color:#64748b;">Kosong</div>`; 
            // [PERBAIKAN] Menambahkan alt text
            data.forEach(i=>{ c.innerHTML+=`<div onclick="${currentProfileTab==='history'?`navigateTo('?page=watch&id=${i.id}&ep=${i.lastEp}')`:`openSynopsisAndTrack('${i.id}')`}" class="movie-card"><img src="${i.image}" alt="${i.title}" class="poster-card loaded"><div class="ep-badge">${currentProfileTab==='history'?'EP '+i.lastEp:'‚ô•'}</div><div class="movie-info"><div class="movie-title">${i.title}</div></div></div>`; }); 
        }
        function switchProfileTab(t) { currentProfileTab=t; renderProfile(); }

        function doSearch(v) { 
            const b=document.getElementById('search-results'); 
            if(!v){b.classList.add('hide');return;} 
            const r=appData.donghua.filter(d=>d.title.toLowerCase().includes(v.toLowerCase())).slice(0,5); 
            b.innerHTML=r.length?"":`<div style="padding:10px;text-align:center;font-size:12px;">Tidak ditemukan</div>`; 
            // [PERBAIKAN] Menambahkan alt text
            r.forEach(i=>{b.innerHTML+=`<div onclick="navigateTo('?page=synopsis&id=${i.id}');document.getElementById('search-results').classList.add('hide');" class="search-item"><img src="${i.image}" alt="${i.title}"><div><div style="font-weight:bold;font-size:12px;">${i.title}</div></div></div>`}); 
            b.classList.remove('hide'); 
        }
        document.addEventListener('click', e=>{if(!e.target.closest('.search-box'))document.getElementById('search-results').classList.add('hide')});
        function showShare(id,ep,title){ const url=`${CONFIG.workerUrl}/share?id=${id}${ep?'&ep='+ep:''}`, txt=ep?`Nonton ${title} Episode ${ep}`:`Nonton ${title}`; navigator.clipboard.writeText(`${window.location.origin}${window.location.pathname}?page=${ep?'watch':'synopsis'}&id=${id}${ep?'&ep='+ep:''}`).then(()=>alert("Link tersalin")).catch(()=>{}); window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(txt)}`,'_blank'); }
    
        function toggleLandscape() { const c=document.getElementById('video-container'), b=document.getElementById('btn-rotate-toggle'); if(c.classList.contains('forced-landscape')){ resetLandscapeMode(); } else { c.classList.add('forced-landscape'); b.classList.add('rotate-active'); b.innerHTML=`<span>‚úñ</span> Keluar`; } }
        function resetLandscapeMode() { const c=document.getElementById('video-container'), b=document.getElementById('btn-rotate-toggle'); if(c) c.classList.remove('forced-landscape'); if(b) { b.classList.remove('rotate-active'); b.innerHTML=`<span>‚ü≥</span> Putar`; } }
    </script>
</body>
</html>
